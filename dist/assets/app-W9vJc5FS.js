import{g as p,c as m,D as l,H as fo,X as S,P as V,b as go,J as K,Q as j,Z as mo,V as ho,l as U,K as M,q as N,B as E,a as yo,v as vo}from"./Button-D90MJZYY.js";import{T as xo}from"./Textarea-DCGXDJY1.js";import{A as wo,L as bo,T as So}from"./AnimateDots-BLRSv2HL.js";import"./Knowledge-GiF_E7_B.js";function Co({shot:i,lineZoneWidth:t},{createElement:n}){const u=()=>({display:"flex",position:"absolute",left:i.position().x,top:i.position().y,alignItems:"stretch",zIndex:2}),s={width:t,background:"transparent",height:"100%"},a=()=>({boxSizing:"border-box",background:m.panelBg,borderRadius:4,minHeight:100,width:270,border:`1px solid ${m.panelBorder}`,padding:`${p.medium}px ${p.large}px`,"&:hover":{outline:"1px solid #253FFD"}}),g={position:"absolute",top:-p.large,left:p.small,colors:m.description},r={height:26,display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":2,overflow:"hidden",textOverflow:"ellipsis ellipsis",fontSize:12,marginTop:p.medium};return n("div",{style:u},n("div",{style:g},i.name),n("div",{as:"leftConnectZone",style:{...s,position:"absolute",top:0,left:-t,overflow:"visible",cursor:"crosshair"}}),n("div",{as:"main",style:a,ref:[i.size.ref]},n("div",{style:{fontSize:14,fontWeight:"bold"}},i.label),n("div",{style:r},i.description),n("div",{style:{marginTop:p.small}}),n("img",{src:i.cover,style:{width:"100%",borderRadius:6,overflow:"hidden"},draggable:!1})),n("div",{as:"rightConnectZone",style:{...s,position:"absolute",top:0,right:-t,cursor:"crosshair"}}))}function Lo({from:i,to:t},{createSVGElement:n,Fragment:u}){const s=()=>{var h;return i().position().x+(((h=i().size())==null?void 0:h.borderBoxWidth)||0)},a=()=>{var h;return i().position().y+(((h=i().size())==null?void 0:h.borderBoxHeight)||0)/2},g=()=>{var h;return t().position().y+(((h=t().size())==null?void 0:h.borderBoxHeight)||0)/2},r=()=>t().position().x,v=()=>{const h=(s()+r())/2,b=(a()+g())/2;return`M ${s()} ${a()} Q ${s()+20} ${a()} ${h} ${b} T ${r()} ${g()}`},c=l(!1),w=()=>c()?"#2346f5":"rgba(166,166,166, 1)";return n(u,null,n("path",{as:"mainPath",stroke:w,strokeOpacity:"1",fill:"none",fillOpacity:"1",pointerEvents:"visibleStroke",d:v}),n("path",{stroke:"rgba(34,34,34, 0)",strokeOpacity:"1","stroke-width":10,d:v,fill:"none",pointerEvents:"visibleStroke",onmouseenter:()=>c(!0),onmouseleave:()=>c(!1)}),()=>c()?n("g",{onmouseenter:()=>c(!0),onmouseleave:()=>c(!1),as:"insert"},n("circle",{cx:()=>(s()+r())/2,cy:()=>(a()+g())/2,r:6,fill:w,onmouseenter:()=>c(!0),onmouseleave:()=>c(!1)}),n("line",{stroke:"#fff",x1:()=>(s()+r())/2-3,y1:()=>(a()+g())/2,x2:()=>(s()+r())/2+3,y2:()=>(a()+g())/2}),n("line",{stroke:"#fff",x1:()=>(s()+r())/2,y1:()=>(a()+g())/2-3,x2:()=>(s()+r())/2,y2:()=>(a()+g())/2+3})):null,n("circle",{as:"fromDot",cx:()=>s()+3,cy:a,r:3,fill:w}),n("circle",{as:"toDot",cx:()=>r()-3,cy:g,r:3,fill:w}))}const Bo="customdragmousemove";function ko(i,t){const n=()=>{const u=s=>{t({clientX:s.clientX,clientY:s.clientY}),i.dispatchEvent(new CustomEvent(Bo,{detail:{clientX:s.clientX,clientY:s.clientY}}))};i.addEventListener("mousemove",u),i.addEventListener("mouseup",()=>{console.log("mouseup"),t(null),i.removeEventListener("mousemove",u)},{once:!0})};return i.addEventListener("mousedown",n),()=>{i.removeEventListener("mousedown",n)}}function $o(i){return(t,n)=>{const u=a=>{n({clientX:a.clientX,clientY:a.clientY,offsetX:a.offsetX,offsetY:a.offsetY})},s=fo(()=>{i()?t.addEventListener("mousemove",u):(t.removeEventListener("mousemove",u),n(null))});return()=>{t.removeEventListener("mousemove",u),s(),n(null)}}}function zo({x1:i,x2:t,y1:n,y2:u},{createSVGElement:s}){return s("svg",{style:()=>({width:Math.max(t(),i())+10,height:Math.max(u(),n())+10,maxWidth:"100%",maxHeight:"100%"})},s("circle",{cx:()=>i()+2,cy:n,r:2,fill:"#F2880E"}),s("line",{x1:i,y1:n,x2:t,y2:u,stroke:"#F2880E"}),s("circle",{cx:()=>t()+2,cy:u,r:2,fill:"#F2880E"}))}function Io({},{createSVGElement:i}){return i("svg",{width:"8",height:"6",viewBox:"0 0 8 6",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i("rect",{width:"5.86236",height:"0.97706",rx:"0.48853",transform:"matrix(-0.68232 -0.731054 -0.68232 0.731054 4.6665 4.78564)",fill:"#FEFEFF"}),i("rect",{width:"5.86236",height:"0.97706",rx:"0.48853",transform:"matrix(0.68232 -0.731054 -0.68232 -0.731054 4 5.5)",fill:"#FEFEFF"}))}const To={value:S.atom().default(()=>l(null)).isRequired,placeholder:S.atom().default(()=>l("")),options:S.rxList().default(()=>new V([])).isRequired};function J(i,{createElement:t,createPortal:n,context:u,createStateFromRef:s}){var A,O;const{value:a,options:g,placeholder:r}=i,v=go(g,a),c=l(!1),w=((A=u.get(K))==null?void 0:A.viewport)||window,h=((O=u.get(K))==null?void 0:O.container)||document.body,b=s(j,w),x=()=>{var f,B;return{position:"fixed",top:0,left:0,width:(f=b())==null?void 0:f.width,height:(B=b())==null?void 0:B.height,backgroundColor:"transparent"}},P=s(j),I=s(mo({type:"interval",duration:100})),G=()=>{var f,B,C;return{position:"absolute",display:"flex",flexDirection:"column",top:((f=I())==null?void 0:f.top)+((B=P())==null?void 0:B.height)+10,left:(C=I())==null?void 0:C.left,border:`1px solid ${m.innerBorder}`,background:"#000",color:"#fff",borderRadius:8,overflow:"hidden"}},W=f=>{a(f),c(!1)},L=l(null),F=v.map(([f,B])=>{const C=l(!1),R=l(!1),X=()=>({cursor:"pointer",padding:p.small,backgroundColor:C()?m.primaryBlue:R()?m.primaryBlue:"transparent"});return t("div",{as:"option",onClick:()=>W(f),onkeydown:ho(()=>W(f)),onMouseEnter:()=>R(!0),onMouseLeave:()=>R(!1),onFocusIn:[()=>C(!0),()=>L(f)],onFocusOut:[()=>C(!1),()=>L()===f&&L(null)],style:X,"prop:focused":C,"prop:value":f,"prop:selected":B,"prop:optionVisible":c},f)}),H={background:m.panelBg,padding:`${p.small/2}px ${p.small}px`,cursor:"pointer",borderRadius:4,display:"flex",alignItems:"center",gap:p.small,color:m.description};return t("div",{as:"root",ref:[P.ref,I.ref]},t("div",{as:"displayValue","prop:value":a,"prop:placeholder":r,"prop:optionVisible":c,onClick:()=>c(!0),style:H},t("span",null,()=>a()??r()),t(Io,null)),()=>c()?n(()=>t("div",{as:"dropdownBackground",style:x(),onClick:()=>c(!1)},t("div",{as:"options",style:G,"prop:value":g},F)),h):null)}J.propTypes=To;function Mo({},{createSVGElement:i}){return i("svg",{width:"20",height:"19",viewBox:"0 0 20 19",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M0.394857 7.15816L16.595 5.46925C16.7035 5.45795 16.8005 5.53667 16.8118 5.64508C16.8172 5.69707 16.8018 5.74909 16.7689 5.78972L6.33381 18.6794C6.26523 18.7641 6.14096 18.7772 6.05624 18.7086C6.01482 18.6751 5.98873 18.6262 5.98388 18.5732L5.44978 12.719L11.8574 8.27302L4.75063 11.3578L0.286356 7.50384C0.203852 7.43261 0.194709 7.30799 0.265934 7.22549C0.29877 7.18745 0.344879 7.16337 0.394857 7.15816Z",fill:"#253FFD"}))}function Po({},{createSVGElement:i}){return i("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i("path",{d:"M0.454143 2.00127L1.744 0.759208C1.77875 0.723857 1.82003 0.69581 1.86548 0.676673C1.91093 0.657536 1.95965 0.647685 2.00885 0.647685C2.05806 0.647685 2.10678 0.657536 2.15223 0.676673C2.19768 0.69581 2.23896 0.723857 2.27371 0.759208L11.0625 9.83479C11.1784 9.95435 11.2698 10.096 11.3313 10.2517C11.3929 10.4073 11.4235 10.5737 11.4212 10.7414C11.419 10.9091 11.3841 11.0747 11.3184 11.2285C11.2527 11.3824 11.1576 11.5216 11.0386 11.6379C10.7966 11.8745 10.4724 12.0046 10.1365 11.9999C9.80048 11.9952 9.47992 11.8561 9.24447 11.6129L0.455639 2.53727C0.420659 2.50229 0.392855 2.46063 0.373831 2.41468C0.354807 2.36874 0.34494 2.31943 0.344801 2.26959C0.344662 2.21976 0.354253 2.17039 0.37302 2.12433C0.391787 2.07828 0.419359 2.03645 0.454143 2.00127ZM2.69792 3.7429L3.39597 3.03683L1.97818 1.59813C1.97385 1.59361 1.96868 1.59002 1.96296 1.58756C1.95724 1.5851 1.95109 1.58384 1.94488 1.58384C1.93867 1.58384 1.93253 1.5851 1.92681 1.58756C1.92109 1.59002 1.91591 1.59361 1.91159 1.59813L1.27938 2.23739C1.27094 2.24629 1.26628 2.25821 1.26642 2.27057C1.26656 2.28293 1.27148 2.29473 1.28013 2.30344L2.69792 3.7429ZM6.76277 2.65723L8.45664 3.59713L9.38138 5.31446L10.3076 3.59713L12 2.65723L10.3076 1.71809L9.38138 0L8.45589 1.71885L6.76277 2.65723ZM3.86807 9.12189L2.74581 8.78936L3.07426 9.92817L2.74581 11.067L3.86807 10.7322L4.99034 11.0662L4.66039 9.92741L4.99034 8.7886L3.86807 9.12265V9.12189ZM1.12226 6.0228L0 5.69027L0.327702 6.82908L0 7.96789L1.12226 7.63232L2.24453 7.96789L1.91383 6.82908L2.24453 5.69027L1.12226 6.0228Z",fill:"white"}))}const Do={shot:S.any.isRequired,lineZoneWidth:S.number.isRequired,shotType:S.atom().default(()=>l("video")),shotTypeOptions:S.rxList().isRequired.default(()=>new V(["video","shot video","mv"])),template:S.atom().default(()=>l("template A")),templateOptions:S.rxList().isRequired.default(()=>new V(["template A","template B","template C"])),prompt:S.atom().default(()=>l("")),generating:S.atom().default(()=>l(!1))};function oo(i,{createElement:t}){const{shot:n,generating:u,lineZoneWidth:s,prompt:a,template:g,shotType:r,shotTypeOptions:v,templateOptions:c}=i,w=()=>({position:"absolute",left:n.position().x,top:n.position().y,zIndex:2}),h=()=>({display:"flex",alignItems:"stretch"}),b={width:s,background:"transparent",height:"100%"},x=()=>({boxSizing:"border-box",background:m.panelBg,borderRadius:4,width:270,height:223,display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center",border:`1px solid ${m.innerBorder}`,padding:`${p.medium}px ${p.large}px`,"&:hover":{outline:"1px solid #253FFD"}}),P={background:"#000",border:`1px solid ${m.innerBorder}`,borderRadius:4,color:m.description,fontSize:16,display:"flex",alignItems:"center",marginTop:p.small},I=t("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},t("div",{as:"optimize",style:{display:"flex",alignItems:"center",gap:p.small}},t(Po,null),t("span",null,"optimize")),t("div",{as:"confirm",style:{cursor:"pointer"}},t(Mo,null)));return t("div",{style:w},t("div",{style:h},t("div",{as:"leftConnectZone",style:{...b,position:"absolute",top:0,left:-s,overflow:"visible",cursor:"crosshair"}}),t("div",{as:"main",style:x,ref:[n.size.ref]},t("img",{src:"/empty.svg",style:{width:86},draggable:!1}),t("div",{style:{fontSize:14,marginTop:p.small,color:"rgba(255,255,255,.4)"}},()=>u()?t(wo,{count:7}):"To be generated")),t("div",{as:"rightConnectZone",style:{...b,position:"absolute",top:0,right:-s,cursor:"crosshair"}})),t("div",{style:{width:360}},t("div",{style:P},t("div",{style:{padding:p.small,borderRight:`1px solid ${m.innerBorder}`}},"Settings"),t("div",{style:{marginLeft:p.small}},t(J,{value:r,options:v})),t("div",{style:{marginLeft:p.small}},t(J,{value:g,options:c}))),t("div",{style:{marginTop:p.small}},t(xo,{as:"prompt",value:a,"$footer:_use":I}))))}oo.propTypes=Do;const Ro=[{id:"1",label:"1",name:"A-1",description:"The Potala Palace is a dzong fortress in Lhasa, capital of the Tibet Autonomous Region in China. It was the winter palace of the Dalai Lamas from 1649 to 1959, has been a museum since then, and a World Heritage Site since 1994.",type:"mv",cover:"/image.png",position:{x:50,y:50}},{id:"2",label:"2",name:"B-1",description:"The Potala Palace is a dzong fortress in Lhasa, capital of the Tibet Autonomous Region in China. It was the winter palace of the Dalai Lamas from 1649 to 1959, has been a museum since then, and a World Heritage Site since 1994.",type:"mv",cover:"/image2.png",position:{x:450,y:50}},{id:"3",label:"3",name:"C-1",description:"The Potala Palace is a dzong fortress in Lhasa, capital of the Tibet Autonomous Region in China. It was the winter palace of the Dalai Lamas from 1649 to 1959, has been a museum since then, and a World Heritage Site since 1994.",type:"mv",cover:"/image2.png",position:{x:650,y:450}}],Xo=[{id:1,from:"1",to:"2"}],_=150;function Yo({scale:i},{createElement:t,createStateFromRef:n,createRef:u,createPortal:s,createSVGElement:a}){const g=o=>({id:o.id,label:l(o.label||""),name:l(o.name||""),description:l(o.description||""),type:l(o.type||""),cover:l(o.cover||""),position:l(o.position),size:n(j)}),r=new U(Ro.map(o=>[o.id,g(o)])),v=new U(Xo.map(o=>[o.id,{...o,from:l(r.get(o.from)),to:l(r.get(o.to))}])),c=u(),w=l(null),h=l(null),b=n(ko),x=l(null),P=()=>{var o,e,d,y;return(((e=(o=x())==null?void 0:o.position())==null?void 0:e.x)||0)+(((y=(d=x())==null?void 0:d.size())==null?void 0:y.borderBoxWidth)||0)},I=()=>{var o,e,d,y;return(((e=(o=x())==null?void 0:o.position())==null?void 0:e.y)||0)+(((y=(d=x())==null?void 0:d.size())==null?void 0:y.borderBoxHeight)||0)/2},G=()=>{var o,e;return(o=L())!=null&&o.clientX?((e=L())==null?void 0:e.clientX)-c.current.getBoundingClientRect().left:P()},W=()=>{var o,e;return(o=L())!=null&&o.clientY?((e=L())==null?void 0:e.clientY)-c.current.getBoundingClientRect().top:I()},L=n($o(x)),F=o=>{x(o)},H=o=>{const e={id:v.size()+1,from:l(r.get(x().id)),to:l(r.get(o.id))};v.set(e.id,e),x(null)},A=o=>{const e=new Set;q(o.from(),new Set,new Set,e,!0);const d=o.from().size().borderBoxWidth,y=X({x:o.from().position().x+_+d,y:o.from().position().y}),k=v.size()+1;v.set(k,{id:k,from:l(r.get(o.from().id)),to:l(r.get(y))}),o.from(r.get(y)),e.forEach($=>{$.position({x:$.position().x+_+d,y:$.position().y})})},O=()=>{const o=w();o&&o.position({x:b().clientX-h().x,y:b().clientY-h().y})},f=l(null),B=()=>{var o,e;return{color:"#fff",position:"absolute",top:((o=f())==null?void 0:o.clientY)||0,left:((e=f())==null?void 0:e.clientX)||0,background:m.inputBg,borderRadius:4,overflow:"hidden"}},C={padding:`${p.medium}px ${p.medium}px`,cursor:"pointer","&:hover":{background:m.primaryBlue}},R=()=>X(),X=o=>{const e=r.size()+1;return r.set(e,g({id:e,position:o||{x:f().clientX-c.current.getBoundingClientRect().left,y:f().clientY-c.current.getBoundingClientRect().top}})),e},to=()=>{const o=X(),e=v.size()+1,d=T().id;v.set(e,{id:e,from:l(r.get(d)),to:l(r.get(o))})},io=s(()=>t("div",{style:{position:"absolute",top:0,left:0,height:"100%",width:"100%",background:"transparent",zIndex:"999"},onClick:[()=>f(null)]},t("div",{style:B},t("div",{style:{fontSize:12,padding:`${p.small}px ${p.medium}px`}},"new"),t("div",null,t("div",{style:C,onClick:R},"Single shot"),()=>T()?t("div",{style:C,onClick:to},"Continuation shot"):null))),document.body),no=o=>(o.preventDefault(),o.stopPropagation(),f(o),!1),eo=o=>{},Q=()=>{const o=Math.max(...r.values().data.map(d=>{var y;return d.position().x+(((y=d.size())==null?void 0:y.borderBoxWidth)||0)})),e=Math.max(...r.values().data.map(d=>{var y;return d.position().y+(((y=d.size())==null?void 0:y.borderBoxHeight)||0)}));return{width:o+_+500,height:e+500}},so=()=>({position:"relative",minWidth:"100%",minHeight:"100%",...Q(),overflow:"auto",backgroundImage:"radial-gradient(circle at 2px 2px, #222 2px,transparent 0)",backgroundSize:"30px 30px,30px 30px",userSelect:"none"}),lo=()=>({transform:`scale(${i()})`,height:"100%",width:"100%"}),T=l(null),ro=r.values().createSelection(T),ao=v.values().groupBy(o=>o.from().id),po=v.values().groupBy(o=>o.to().id),q=(o,e,d,y=new Set,k=!1)=>{const $=[o];for(;$.length;){const Y=$.shift();e.add(Y);const D=k?ao.get(Y.id):po.get(Y.id);D&&D.forEach(z=>{d.add(z),y.add(k?z.to():z.from()),e.has(k?z.to():z.from())||$.push(k?z.to():z.from())})}},uo=new V(null,()=>{if(!T())return[];const o=new Set,e=new Set;return q(T(),o,e,new Set,!0),q(T(),o,e),Array.from(e)}),co=v.values().createSelection(uo);return t("div",{style:so,oncontextmenu:no,onwheel:eo,ref:[c,b.ref,L.ref],onCustomDragMouseMove:O,onClick:()=>T(null),onmouseup:()=>x(null)},t("div",{style:lo},()=>x()?t("div",{style:{position:"absolute",top:0,left:0,zIndex:1}},t(zo,{x1:P,y1:I,x2:G,y2:W})):null,t("div",{style:{position:"absolute",top:0,left:0,zIndex:1,width:"100%",minHeight:"100%"}},a("svg",{style:Q},co.map(([o,e])=>t(Lo,{from:o.from,to:o.to,"$insert:onClick":()=>A(o),"$mainPath:stroke_":d=>()=>e()?m.primaryBlue:d(),"$toDot:fill_":d=>()=>e()?m.primaryBlue:d(),"$fromDot:fill_":d=>()=>e()?m.primaryBlue:d()})))),ro.map(([o,e])=>()=>{if(o.type())return t(Co,{shot:o,lineZoneWidth:10,"$main:onmousedown":[M(()=>w(o)),M(Z=>h({x:Z.clientX-o.position().x,y:Z.clientY-o.position().y}))],"$main:onmouseup":M(()=>w(null)),"$main:onClick":[N(()=>T(o))],"$leftConnectZone:onmouseup":N(()=>H(o)),"$rightConnectZone:onmouseup":N(M(()=>F(o))),"$main:style":()=>({border:`1px solid ${e()?m.primaryBlue:m.innerBorder}`})});const d=l("video"),y=["video","mv"],k=l("template1"),$=["template1","template2"],Y=l(""),D=l(!1),z=()=>{D(!0),setTimeout(()=>{D(!1),o.type(d),o.label("new shot"),o.description("new shot description"),o.name("D-1"),o.cover("/image.png")},1e3)};return t(oo,{shot:o,lineZoneWidth:10,shotType:d,shotTypeOptions:y,template:k,prompt:Y,generating:D,templateOptions:$,"$leftConnectZone:onmouseup":()=>H(o),"$rightConnectZone:onmouseup":M(()=>F(o)),"$main:onmousedown":[M(()=>w(o)),M(Z=>h({x:Z.clientX-o.position().x,y:Z.clientY-o.position().y}))],"$main:onmouseup":M(()=>w(null)),"$confirm:onClick":z})}),()=>f()?io:null))}function Zo({},{createElement:i}){const t={display:"flex",flexDirection:"column",width:"100%",height:"100%",overflow:"hidden",color:"#fff",fontSize:12},n={height:56,width:"100%",background:"#1E1F24",borderBottom:"1px solid #333",flexGrow:0,flexShrink:0,flexBasis:56,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:14,position:"relative"},u={display:"flex",flexDirection:"column",width:"100%",flexGrow:1,minHeight:0,overflow:"hidden"},s={width:"100%",height:40,background:"#000000",flexGrow:0,flexShrink:0,flexBasis:50},a={width:"100%",flexGrow:1,background:"#000",color:"#fff",overflow:"auto",minHeight:0},g=l(1),r=()=>{window.location.href="/"};return i("div",{style:t},i("div",{style:n},i("div",{style:{position:"absolute",left:p.small,cursor:"pointer"},onClick:r},i(bo,null)),i("div",null,"Mystical Tibet: A Journey into the Roof of the World"),i("div",{style:{position:"absolute",right:p.medium,display:"flex",gap:p.medium,alignItems:"center"}},i(E,null,"Preview"),i(E,{primary:!0},"Export"),i("div",{style:{width:32,height:32,borderRadius:16,marginLeft:p.medium}},i("img",{src:"/avatar.png",width:32,height:32})))),i("div",{style:u},i("div",{style:s},i(So,{scale:g})),i("div",{style:a},i(Yo,{scale:g}))))}const Wo=yo(document.getElementById("root"));Wo.render(vo(Zo,null));
